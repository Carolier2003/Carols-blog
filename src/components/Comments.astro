---
// Giscus uses data-mapping="pathname" to map discussions based on current URL
// No slug prop needed - discussions are created automatically per page
---

<div class="comments-section">
  <div class="section-header">
    <h3>评论</h3>
  </div>

  <div class="giscus-container">
    <script
      is:inline
      data-astro-rerun
      src="https://giscus.app/client.js"
      data-repo="Carolier2003/Carols-blog"
      data-repo-id="R_kgDOROT-5Q"
      data-category="Announcements"
      data-category-id="DIC_kwDOROT-5c4C2R8n"
      data-mapping="pathname"
      data-strict="0"
      data-reactions-enabled="1"
      data-emit-metadata="0"
      data-input-position="bottom"
      data-theme="https://blog.kon-carol.xyz/giscus-light.css"
      data-lang="zh-CN"
      crossorigin="anonymous"
      async></script>
  </div>
</div>

<script>
  // Set initial Giscus theme based on current page theme
  const baseUrl = "https://blog.kon-carol.xyz";
  function initGiscusTheme() {
    const isDark =
      document.documentElement.getAttribute("data-theme") === "dark";
    const theme = isDark
      ? `${baseUrl}/giscus-dark.css`
      : `${baseUrl}/giscus-light.css`;
    const giscusScript = document.querySelector(
      'script[src="https://giscus.app/client.js"]'
    );
    if (giscusScript) {
      giscusScript.setAttribute("data-theme", theme);
    }
  }

  // Run immediately and after page transitions
  initGiscusTheme();
  document.addEventListener("astro:after-swap", initGiscusTheme);
</script>

<style>
  .comments-section {
    margin-top: 3rem;
    padding-top: 1.5rem;
    border-top: 1px solid var(--border);
  }

  .section-header {
    margin-bottom: 1.5rem;
  }

  .section-header h3 {
    font-size: 1.25rem;
    font-weight: 600;
    margin: 0;
    letter-spacing: -0.025em;
    color: var(--foreground);
  }

  .giscus-container {
    min-height: 200px;
  }
</style>
